const f=e=>new Promise(i=>setTimeout(i,e)),g=()=>{const e=localStorage.getItem("consumer_users");return e?JSON.parse(e):[]},S=e=>{localStorage.setItem("consumer_users",JSON.stringify(e))},w=()=>{const e=localStorage.getItem("consumer_pending_verifications");return e?JSON.parse(e):[]},p=e=>{localStorage.setItem("consumer_pending_verifications",JSON.stringify(e))},h=()=>Math.floor(1e5+Math.random()*9e5).toString(),C=e=>{const i=e.replace(/\D/g,"");if(i.length!==11||/^(\d)\1{10}$/.test(i))return!1;let t=0;for(let o=0;o<9;o++)t+=parseInt(i[o])*(10-o);let s=11-t%11;s>9&&(s=0),t=0;for(let o=0;o<10;o++)t+=parseInt(i[o])*(11-o);let r=11-t%11;return r>9&&(r=0),s===parseInt(i[9])&&r===parseInt(i[10])},I=e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),E={async register(e){await f(1500);const{nome:i,cpf:t,email:s,telefone:r,verificationMethod:o,emailNotifications:n,whatsappNotifications:a,isWhatsapp:l}=e;if(!i||!t||!s||!r)throw new Error("Todos os campos são obrigatórios");if(!C(t))throw new Error("CPF inválido");if(!I(s))throw new Error("E-mail inválido");if(g().find(m=>m.cpf===t.replace(/\D/g,"")||m.email===s))throw new Error("Usuário já cadastrado com este CPF ou e-mail");const c=h(),d=w(),v={id:Date.now().toString(),userData:{nome:i,cpf:t.replace(/\D/g,""),email:s,telefone:r.replace(/\D/g,""),emailNotifications:n,whatsappNotifications:a,isWhatsapp:l},verificationCode:c,verificationMethod:o,createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+10*60*1e3).toISOString()};return d.push(v),p(d),console.log(`Código de verificação enviado via ${o}:`,c),o==="email"?(console.log(`E-mail enviado para: ${s}`),console.log(`Código: ${c}`)):o==="whatsapp"&&(console.log(`WhatsApp enviado para: ${r}`),console.log(`Código: ${c}`)),{success:!0,message:`Código de verificação enviado via ${o==="email"?"e-mail":"WhatsApp"}`,verificationId:v.id}},async verifyAndCreateAccount(e){await f(1500);const{cpf:i,verificationCode:t,password:s,confirmPassword:r}=e;if(!t||t.length!==6)throw new Error("Código de verificação deve ter 6 dígitos");if(!s||s.length<6)throw new Error("Senha deve ter pelo menos 6 caracteres");if(s!==r)throw new Error("Senhas não coincidem");const o=w(),n=o.findIndex(d=>d.userData.cpf===i.replace(/\D/g,"")&&d.verificationCode===t);if(n===-1)throw new Error("Código de verificação inválido ou expirado");const a=o[n];if(new Date>new Date(a.expiresAt))throw o.splice(n,1),p(o),new Error("Código de verificação expirado. Solicite um novo código.");const l=g(),u={id:Date.now().toString(),...a.userData,password:s,createdAt:new Date().toISOString(),isActive:!0};l.push(u),S(l),o.splice(n,1),p(o);const{password:D,...c}=u;return{success:!0,message:"Conta criada com sucesso",user:c}},async login(e){await f(1e3);const{cpf:i,password:t}=e;if(!i||!t)throw new Error("CPF e senha são obrigatórios");const r=g().find(a=>a.cpf===i.replace(/\D/g,"")&&a.password===t&&a.isActive);if(!r)throw new Error("CPF ou senha incorretos");const{password:o,...n}=r;return{success:!0,message:"Login realizado com sucesso",user:n}},async resendVerificationCode(e){await f(1e3);const i=w(),t=i.findIndex(o=>o.userData.cpf===e.replace(/\D/g,""));if(t===-1)throw new Error("Nenhuma verificação pendente encontrada para este CPF");const s=h();i[t].verificationCode=s,i[t].expiresAt=new Date(Date.now()+6e5).toISOString(),p(i);const r=i[t].verificationMethod;return console.log(`Novo código de verificação enviado via ${r}:`,s),{success:!0,message:`Novo código enviado via ${r==="email"?"e-mail":"WhatsApp"}`}},async checkUserExists(e,i){await f(500);const s=g().find(r=>r.cpf===e.replace(/\D/g,"")||r.email===i);return{exists:!!s,user:s?{cpf:s.cpf,email:s.email}:null}}};export{E as authService,E as default};
